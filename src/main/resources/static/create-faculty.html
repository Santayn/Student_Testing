<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Управление факультетами</title>
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:Arial,sans-serif;display:flex;min-height:100vh}
        .sidebar{width:250px;background:#f4f4f4;padding:20px;box-shadow:2px 0 5px rgba(0,0,0,.1);overflow:auto}
        .sidebar a{display:block;margin-bottom:15px;text-decoration:none;color:#333;font-size:16px}
        .sidebar a:hover{color:#007BFF}
        .content{flex:1;padding:20px;overflow:auto}
        form{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:30px;background:#fff;padding:15px;border-radius:6px;box-shadow:0 0 5px rgba(0,0,0,.1)}
        label{font-weight:bold}
        input{width:100%;padding:8px;margin-top:5px}
        button{padding:10px 20px;background:#28a745;color:#fff;border:0;cursor:pointer;font-size:16px;border-radius:4px}
        button:hover{background:#218838}
        table{width:100%;border-collapse:collapse;margin-top:10px}
        th,td{border:1px solid #ddd;padding:10px;text-align:left}
        th{background:#f2f2f2}
        .delete-btn{background:#dc3545;color:#fff;border:0;padding:6px 10px;cursor:pointer;font-size:14px;border-radius:4px}
        .delete-btn:hover{background:#c82333}
        .error{margin-top:8px;color:#b00020}
    </style>
</head>
<body>
<div class="sidebar">
    <a href="#" onclick="alert('Профиль пользователя (заглушка)')">О пользователе</a>
    <a href="/index.html">Главная</a>
    <a href="/subjects.html">Предметы</a>
    <a href="/about.html">О платформе</a>

    <a href="/students.html">Управление студентами</a>
    <a href="/teachers.html">Управление учителями</a>
    <a href="/roles.html">Управление ролями</a>

    <a href="/teachers-subject.html">Управление предметами</a>
    <a href="/lectures.html">Управление лекциями</a>
    <a href="/topics.html">Управление темами</a>
    <a href="/questions-upload.html">Загрузить вопросы</a>

    <a href="/tests-create.html">Создать тест</a>
    <a href="/results.html" style="font-weight:bold;">Результаты тестов</a>

    <a href="/groups.html" style="font-weight:bold;">Группы</a>
    <a href="/faculties.html" style="font-weight:bold;">Факультеты</a>
</div>

<div class="content">
    <h2>Создать новый факультет</h2>

    <form onsubmit="event.preventDefault(); createFaculty();">
        <div style="flex:1;min-width:260px;">
            <label for="name">Название факультета:</label>
            <input id="name" required />
            <div id="err" class="error"></div>
        </div>
        <div style="align-self:flex-end;">
            <button type="submit">Создать</button>
        </div>
    </form>

    <h3>Список факультетов</h3>
    <table>
        <thead><tr><th>ID</th><th>Название</th><th>Действия</th></tr></thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

<script>
    const API = '/api/v1';

    async function fetchJSON(url, opt={}) {
      const res = await fetch(url, { headers: { 'Accept':'application/json', ...(opt.headers||{}) }, ...opt });
      const txt = await res.text(); let data=null; try{ data = txt? JSON.parse(txt): null }catch{}
      if (!res.ok) throw new Error(data?.message || data?.error?.message || (res.status+' '+res.statusText));
      return data;
    }

    async function loadFaculties() {
      const list = await fetchJSON(`${API}/faculties`);
      const tbody = document.getElementById('tbody');
      tbody.innerHTML = list.map(f => `
        <tr>
          <td>${f.id}</td>
          <td>${f.name ?? ''}</td>
          <td><button class="delete-btn" data-id="${f.id}">Удалить</button></td>
        </tr>
      `).join('');
      tbody.querySelectorAll('button.delete-btn').forEach(b => b.onclick = async () => {
        if (!confirm('Удалить факультет #' + b.dataset.id + '?')) return;
        await fetchJSON(`${API}/faculties/${b.dataset.id}`, { method: 'DELETE' });
        await loadFaculties();
      });
    }

    async function createFaculty() {
      const name = document.getElementById('name').value.trim();
      const err = document.getElementById('err'); err.textContent = '';
      if (!name) { err.textContent = 'Введите название'; return; }
      try{
        await fetchJSON(`${API}/faculties`, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ name })
        });
        document.getElementById('name').value = '';
        await loadFaculties();
      }catch(e){ err.textContent = e.message; }
    }

    loadFaculties();
</script>
</body>
</html>
