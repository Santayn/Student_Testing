<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Лекции по предмету</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">

    <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="h3 mb-0">Лекции</h1>
        <a href="/subjects.html" class="btn btn-outline-secondary btn-sm">К предметам</a>
    </div>

    <div id="meta" class="small text-muted mb-3">Загрузка…</div>
    <div id="err" class="alert alert-danger d-none" role="alert"></div>

    <ul id="list" class="list-group mb-3"></ul>
    <a id="back" class="btn btn-secondary" href="/subjects.html">Назад</a>
</div>

<script>
    (function () {
      const url = new URL(location.href);
      const subjectId = url.searchParams.get('subjectId');

      const meta = document.getElementById('meta');
      const err  = document.getElementById('err');
      const list = document.getElementById('list');
      const back = document.getElementById('back');

      if (!subjectId) {
        err.textContent = 'Не передан subjectId';
        err.classList.remove('d-none');
        meta.textContent = '';
        return;
      }

      // ссылка "назад" возвращает на список предметов
      back.href = '/subjects.html';

      async function load() {
        try {
          meta.textContent = `Предмет #${subjectId}. Загружаем лекции…`;

          const res = await fetch(`/api/v1/public/subjects/${encodeURIComponent(subjectId)}/lectures`, {credentials:'same-origin'});
          if (!res.ok) throw new Error(`Не удалось получить лекции (${res.status})`);
          const items = await res.json();

          list.innerHTML = '';
          if (!items.length) {
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.textContent = 'Пока нет лекций.';
            list.appendChild(li);
          } else {
            items.forEach(l => {
              const li = document.createElement('li');
              li.className = 'list-group-item d-flex justify-content-between align-items-center';

              const a = document.createElement('a');
              a.textContent = l.title || (`Лекция #${l.id}`);
              a.className = 'stretched-link';
              a.href = `/lecture-details.html?subjectId=${encodeURIComponent(subjectId)}&lectureId=${encodeURIComponent(l.id)}`;

              const right = document.createElement('div');
              right.className = 'text-muted small';
              right.textContent = `ID: ${l.id}`;

              li.appendChild(a);
              li.appendChild(right);
              list.appendChild(li);
            });
          }

          meta.textContent = `Всего лекций: ${items.length}`;
        } catch (e) {
          err.textContent = e?.message || 'Ошибка загрузки';
          err.classList.remove('d-none');
          meta.textContent = '';
        }
      }

      load();
    })();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
